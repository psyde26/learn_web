{% extends "base.html" %}

{% block title %} {{ page_title }} {% endblock %}
{% block content %}
  <div class="col-md-12 mb-4 white-text text-center">
      <h1 class="h1-reponsive text-black text-uppercase font-weight-bold mb-0 pt-md-5 pt-5 wow fadeInDown">{{ page_title }}</h1>
  </div>
    <div class="container">
    <div class="row col-md-12 mb-4 white-text text-center">
        <div class="col-6">
        <p>с {{ ev_form.date_start.strftime('%d.%m.%Y') }} по {{ ev_form.date_finish.strftime('%d.%m.%Y') }}</p>
        <p>Страна: {{ ev_form.country.country_name }}</p>
        <p>Вид спорта: {{ ev_form.type.sport_name }}</p>
        <p>Проживание: 
            {% if ev_form.accommodation %}
            Включено
            {% else %}
            Не включено
            {% endif %}
        </p>
        <p>Перелет: 
            {% if ev_form.flight %}
            Включен
            {% else %}
            Не включен
            {% endif %}
        </p>
        <p>Питание:
            {% if ev_form.meals %}
            Включено
            {% else %}
            Не включено
            {% endif %}
        </p>
        {% if ev_form.id in subscribed_events %}
        <a href="{{ ev_form.unsubscribe_event_link }}" class="btn btn-dark" role="button" aria-pressed="true">Отписаться</a>

        {%else%}

        <a href="{{ ev_form.subscribe_link }}" class="btn btn-dark" role="button" aria-pressed="true">Подписаться</a>

        {% endif %}
      </p>
        {% if current_user.is_admin or current_user.id == ev_form.event_creator_id %}
            <a href="{{ ev_form.edit_link }}" class="btn btn-dark btn-default btn-sm" role="button" aria-pressed="true">Редактировать</a>
        {% endif %}
      </p>
        {% if current_user.is_admin or current_user.id == ev_form.event_creator_id %}
          <a href="{{ ev_form.delete_link }}" class="btn btn-dark btn-default btn-sm" role="button" aria-pressed="true">Удалить</a>
        {% endif %}
      </p>
    </div>   
    <div id="comment">
        {% if ev_form.comments %}
        <h3>Комментарии:</h3>
        {% for comment in ev_form.comments %}
        <div class="card text-white bg-dark mb-3">
                <div class="card-body">
                <p class="card-text">{{ comment.text }}</p>
                <p class="card-text">
                        <small>Опубликовано: {{ comment.created.strftime('%d.%m.%Y') }} | 
                        Автор: {{ comment.user.username }}</small>
                </p>
                </div>
        </div>
        {% endfor %}
        {% endif %}
        
        {% if current_user.is_authenticated %}
                <form action="{{ url_for('event.add_comment', ev_id=ev_form.id) }}" method="POST">     
                        {{ comment_form.hidden_tag() }}
                        <div class="form-group">
                                {{ comment_form.comment_text.label }}
                                {{ comment_form.comment_text() }}
                        </div>
                        {{ comment_form.submit() }}
                </form>
        {% else %}
                <p><a href="{{ url_for('user.login') }}">Авторизуйтесь</a>, чтобы комментировать</p>
        {% endif %}
    </div>   
    </div>
  </div>
{% endblock %}
